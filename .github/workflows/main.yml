on: [push]

jobs:
  test_ubt_build_action:
    runs-on: ubuntu-latest
    name: A job to test ufbt action
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Test Action
        uses: ./ # Uses an action in the root directory
        id: test1
        with:
          use-ufbt-version: 'prerelease'
          sdk-channel: 'dev'
          path: 'test'

      - name: Test Action Again
        uses: ./ # Uses an action in the root directory
        id: test2
        with:
          skip-setup: true
          path: 'test'

      - name: Test Action unleashed
        uses: ./ # Uses an action in the root directory
        id: test3
        with:
          skip-setup: true
          path: 'test'
          sdk-channel: 'dev'
          index-url: https://up.unleashedflip.com/directory.json


      - name: Get the output FAPs
        run: echo "Created ${{ steps.test3.outputs.fap-artifacts }}"
        
      - name: Upload app artifacts
        uses: actions/upload-artifact@v3
        with:
          name: app-artifacts
          path: ${{ steps.test3.outputs.fap-artifacts }}
